# Model 1

# MAKE YOUR OWN CONFIG
config=global_config
SSL_augmentation=global_SSL_augmentation
config["name"]="batch_1"
config["max_epochs"]=config["max_epochs"]+3

# THIS IS THE CODE TO SAVE THE CONFIG FILE
config["log_dir"]=join_dir(config["checkpoint_dir"],config["experiment"],config["name"])
with open(join_dir(config["log_dir"], "config.yaml"), 'w') as yaml_file:
    yaml.dump(config, yaml_file, default_flow_style=False)

# THIS IS THE CODE TO LOAD DATASET
pdata= PipeDataset(input_dir=config["dataset_dir"],
    augmentation=dict2transformer(SSL_augmentation,view=config["view"]), samples=config["samples"],batch_size=config["batch_size"], 
    shuffle=config["shuffle"], drop_last=config["drop_last"], num_workers=config["num_workers"])

# THIS IS THE CODE TO LOAD MODEL
pmodel=pipe_model(name=config["model"],
           backbone=config["backbone"], stop_gradient=config["stop_gradient"],prjhead_dim=config["prjhead_dim"])

# THIS IS THE CODE TO TRAIN
trainer = pl.Trainer(
    max_epochs=config["max_epochs"]+3,accelerator=config["device"], 
    callbacks=[ck_callback(config["log_dir"])],
    logger=ContinuousCSVLogger(save_dir=config["log_dir"],name=config["name"])
)
#trainer.fit(pmodel, pdata.dataloader) 

# FOR LOAD PREVIOUS WEIGHT
trainer.fit(pmodel, pdata.dataloader,ckpt_path=(join_dir(config["log_dir"],"checkpoints-epoch=02-train_loss=20.89.ckpt")))  
